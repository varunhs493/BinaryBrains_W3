<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Recycling Centers - ReElectro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        #searchBox {
            padding: 8px;
            width: 250px;
        }
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #map {
            margin-top: 20px;
            border: 1px solid #ccc;
        }
        #centersList {
            margin-top: 10px;
        }
        #centersList li {
            margin-bottom: 8px;
            cursor: pointer;
        }
        #centersList li:hover {
            color: #4CAF50;
        }
        #noResults {
            color: #f44336;
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <header>
        <h1>Find Recycling Centers</h1>
        <a href="../index.html" style="text-decoration: none; font-size: 1.2em;">üè† Home</a>
    </header>

    <section>
        <h2>Enter Your Location</h2>
        <input type="text" id="searchBox" placeholder="Enter city or zip code">
        <button onclick="findCenters()">Search</button>

        <h3>Nearby Centers:</h3>
        <p id="noResults">No recycling centers found for your search. Please try another location.</p>
        <ul id="centersList"></ul>

        <div id="map" style="width: 100%; height: 400px;"></div>
    </section>

    <script>
        // Initialize the map
        var map = L.map('map').setView([20.5937, 78.9629], 5); // Default to India
        var markers = L.layerGroup().addTo(map);

        // Load OSM tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // All available centers
        const allCenters = [
            {name: "E-waste Recycling", location: "Mysore", lat: 12.2958, lon: 76.6394},
            {name: "Sustainable E-Waste", location: "Bangalore", lat: 12.9716, lon: 77.5946},
            {name: "Green Recycling Center", location: "New Delhi", lat: 28.6139, lon: 77.2090},
            {name: "Eco Waste Solutions", location: "Mumbai", lat: 19.0760, lon: 72.8777},
            {name: "Clean Tech Recyclers", location: "Chennai", lat: 13.0827, lon: 80.2707},
        ];

        function findCenters() {
            // Clear previous markers and results
            markers.clearLayers();
            let list = document.getElementById('centersList');
            list.innerHTML = "";
            
            const searchTerm = document.getElementById('searchBox').value.trim().toLowerCase();
            let filteredCenters = [];
            
            if (searchTerm) {
                // Filter centers based on search term
                filteredCenters = allCenters.filter(center => 
                    center.location.toLowerCase().includes(searchTerm)
                );
            } else {
                // If no search term, show all centers
                filteredCenters = [...allCenters];
            }

            // Show or hide "no results" message
            document.getElementById('noResults').style.display = 
                filteredCenters.length === 0 ? 'block' : 'none';

            // Populate list and add markers
            filteredCenters.forEach(center => {
                // Add to list
                let li = document.createElement('li');
                li.textContent = `${center.name} - ${center.location}`;
                li.onclick = () => {
                    map.setView([center.lat, center.lon], 14);
                    // Find and open the popup for this marker
                    markers.eachLayer(marker => {
                        if (marker._latlng.lat === center.lat && marker._latlng.lng === center.lon) {
                            marker.openPopup();
                        }
                    });
                };
                list.appendChild(li);

                // Add marker to the map
                let marker = L.marker([center.lat, center.lon])
                    .bindPopup(`<b>${center.name}</b><br>${center.location}`);
                markers.addLayer(marker);
            });

            // Center map on first result or show all if multiple results
            if (filteredCenters.length === 1) {
                map.setView([filteredCenters[0].lat, filteredCenters[0].lon], 14);
                // Open the popup for the single result
                markers.eachLayer(marker => marker.openPopup());
            } else if (filteredCenters.length > 1) {
                // Create a bounds object
                let bounds = L.latLngBounds(filteredCenters.map(center => [center.lat, center.lon]));
                // Fit the map to the bounds
                map.fitBounds(bounds, {padding: [50, 50]});
            }
        }

        // Allow searching by pressing Enter
        document.getElementById('searchBox').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                findCenters();
            }
        });

        // Initialize with all centers
        findCenters();
    </script>
</body>
</html>